# syntax = docker/dockerfile:1.4
FROM rust:1.70.0-alpine3.18 AS builder

WORKDIR /app
COPY . /app

RUN <<EOF
set -eux
apk add --no-cache musl-dev
EOF

RUN --mount=type=cache,target=/root/.rustup \
    --mount=type=cache,target=/root/.cargo/registry \
    --mount=type=cache,target=/root/.cargo/git \
    --mount=type=cache,sharing=private,target=/app/target <<EOF
set -eux
cargo build --release
cp target/release/gpg-import .
EOF

FROM alpine:3.18

ENV GPG_PRIVATE_KEY="LS0tLS1CRUdJTiBQR1AgUFJJVkFURSBLRVkgQkxPQ0stLS0tLQoKbFFjWUJHUmFvVzRCRUFDcEZibTJzK1BlTnhSSGgzWEZ3QkFrR2RpOHVNODBMRWk0a2ZKTEtOVGU0dUhXMUVkMQpvVnEyNzQ0MmxHbVB0ZVZlYURjU3BMUUQ2a0R2ZHE2TnhRWkQyWFl5QmZ6RDZnVGJkSUR0NkVqZzRYNDRRZ0J1ClFaTjlUd202VklqY0djbEFXZHpsRVBUd3JjUk9lNll1UXlQcHJqMG1BaWp6UUxPMVo4bStOSnhBOHk4SUxEQWEKelVNQzJhQ240c25EQUJmT2J0R2RXS1YzWUMvam5LRytUK1d2SDIxbTRNTk9ncC8zejJSU1hDNmZidDlTZXBrRgp5Qm9SNGk3ZTg5R2VVNm1rdFM3Um1kaE9UY1kraGJEWXpQOU52RzhJREhkcHRRVVhRdFJsTm9xQkMvTTM4a0ZVCjFjUE0rNmN4Zi9WQ3hSUk95VVJvTDNKRElieUltOUlCMVpZdVBFME5tYzVqeUxqdmNLTzdQWDVYYjBaaUFDMjEKWjh0WVE5K2QxM3JkTnE0L0dQMytSbFg0aGpXanZEWWs3VkFrTVUzbkFHdWRGa0NxclhYeUZHeFhpalJJQVRmSgpEbWVtSitoVHZqUjU5MUtaWUxOc1dqbFYzMWllOUdaU2JYYkFHUzV0aVQwMVpNKzQxOGxRN21lemtyU0hScE5jCmlYSHNDMG9wT0FIb2tpbTVEQ1Q3aG5pZ2dTeklnRG9YZ1pERUREQjVTWDduRDArMy9FcXRFY0kvYUpZMlB2U0QKUXZSbjk1TlRWbXZlTEQ3MXNwQ01KaXZpTkhlUisvVWc1MGtSUHVqTFFLaWpQaUFuUzNML2ZiMEhhMlRyRWFpUwpVOWJnRlA1QmVqdlU1U0RUSDMzQnlaU2F2SmlJclVNUmp6MHVidVhKZzBJOFYva01ZNkliZklsVXJRQVJBUUFCCkFBLy9TaWx1U0hXRWg2M3U1aVREQWxab2ZmMGNORUozRjNJby8xTjhTMzBBU1RhSVNkclg4UDh4czdWRTBpbXMKVjAwMzZuMlpVa01OZGY0a055UCtFYzZPSGVwZXpqZ1VFcll0SlRobmFISU9yUndhYVlDQmdkcWZYMEh3aVZxVQpvTDFxcVNBQkpET1l5NHZiNDNTV2dnb08wV3NNQlFURGcxWW92SE5tYUZmWkJSL2t6QmZkalpQa1JYYkE0WUkyCmJxSTJ6dU9LYXhJN21TMkdNN1k2dHllQ0hacVNPS0p5NTVlaHBHYkJvT0l2ek53cmRaaXlUM2ZoLzJBT29ObWUKWW14ZHB4R1ZGSGYvQ1BGUjk1Qlo3ZTJVT1R0aUU4eXIvNkJYT0VtbXNUSUg4K3dTNU1JTDU3TE82N1NoTTdQbApGa0VzMUJXeFBHVTdIN2pIWWIrK2ovRm5xZTdxNVQxcGtxbEU0MTJJYTZpL3c3Z0g4TG5GODdTYkNqVzVzajROCkY2ZjNHQ1c2NzBtMkNXVmoySEhPWDJjQTFyb2ovVWxoVHAxQkY2OW45TElSNlJDaGJUUW5jOWdVVzBybE1xam0KNVluQ3RPRzhndEpOcFVjdGpBeTB2V0FSWTI4TmFJVDZhV0RPRU1LZkhIMmFHbGRTbkFUN3hta1ZhMkEzQkpuQQpUTjFSUnBqblBHR0pWVkhWNlF3eEtPdENNYUlSaWNvZGhwUWdDNFRaMFNMVnphNGo0Mi9USWZvdW1JdHU4ZzdVCmZKUWNVSjVWVmFWWG55aUVpWXhJakgrWVFqTDhuekU5Mmh5Rmd0MXFrckxwY1kxQkxIZnlYQ09uZ01VclBRcTkKM29tV0o1azVYRVRzSHZIMmZPU3FWTlRnWVJyUXBnT1ZsLzlueHdZcXUxcitHWDBJQU1HUSsveDNka1M5dU9nQwpBUVpIWUlHRUlZbm9tZG5ha0ZsSGdZeUJ1VlVJTVRPcDE0TEMwaVBxOTJOSGFHdk9JQ3hqQmxoZGxVdTVYM2JGCm44QTYvNURHUDhDV1dUbmVrYTNrM05hQUw3ZEY1SHJWMGhnZ3U0RnZPYkN2SjVLNmdYZWhSTFB1UWt0cVRxM3MKUVhURFUyR0pITlVNak5Xd1FsTGlQSmJSMitIaHBsdDNDM0cvNFdVdVVPNnVCdnBLWjMvV3l0Z1dPVFFiM0Z6QQpxay93WnJPNWMrZEw3VnhuejRYc0poVXRUcGtRemNQSnlxY3FRdWU3T3JHMU1pRXEvbFc3RndraFU3T3V4UG5KCjl5VnJoM2dOMTRyK2gvdlk5TFNHTEp2S3FvcUkvZmQ3NUhidXo4L1d5M3BnQWVkRng1Z2I2OXdrMDRNTVUwU2gKZngzZE8yOElBTitmUms3Y3lxc09OQ0pnUzBoR1RpVmhFRjBocUd4SFRhaUg5SnhGcTgvRzJFUWRDcVJ0a092ZwpjZmFqeXBkM3VRNzNRd2xmaDBHWUVyT0dvZGNxbDM3S2pweE5WRjVjZ0s1WEdFVW9aRzE4UDB6dUdhaWdJdndnCll5L3JhSjVZdDM5Nmxlc0tGZ2ExSnk5Z25nc1dnVnpjdzhnNk13V2hRbHliLzY1d3gvS0lBQk5Db3hVa2piNFMKQkR4OExPcXNMTGlqUi9Cd2x4MGNDL1RZZjZFNWcvVmZJSjl2VzZjNUljRTdWTFhCWUR3WmNYc1NSeTB2ZTdGVwo1TERJVDRhNk8xQ1JsUDU2RytqMHBRWlpIblE2YVY0dGYwSjBtckM3d1BZQ0JlZzlSSzgvRXlmZndteXRGREZoCnZCb2Ixem44VVdSU3dFQ2FROVl1cy8zbXZsSlEwNk1JQUtDWGZhdmQzNkNISXJYYnJLNFp0UFF0OCthL3IvcjMKQ0tneDFFa0lnU3BQVktvczV3VEU5Q3JXTE41bzlZSTM3VHFtbW52cGVFb0VneHBWUGxkMFJBdHpqM0M5c1dUegpXdVVCQkl3elJ4WElHc1VEdHJpZ3ZLOG5RalBiTXY0cUNZSGp0RkY3QU1WR1pkcEd4eHpkS3ZOUWNtbGtyK3ZJCnlyVzVLclJnZk9WT2ZFMjFnUmFpZVNjQVRBMTdxVVgydHZSc1BZLyt0UmlBdW1sSldGbWVwUzlrUldLcTNPQkMKUUMrUzhYTnVJRW96ZE91REREdDcwRTR6YmZCVWw4dmJreDUrZVcybm1XaG9PblNudXZjTXMxY0NNK1ZMeGtTVQpZMEVSaUtMTTF3YjkyamczR3I1clJnVlhTVTg4NTI0NXdoTy81amV1eFNRM3pCdDFwaDFRSTM5MlRiUVdZbUYwCmJXRnVJRHhpWVhSdFlXNUFaR011WTI5dFBva0NUZ1FUQVFnQU9CWWhCQ1FURmQycmFHVVdMQU9KditVNG1oQjUKMWFVdkJRSmtXcUZ1QWhzREJRc0pDQWNDQmhVS0NRZ0xBZ1FXQWdNQkFoNEJBaGVBQUFvSkVPVTRtaEI1MWFVdgp6RThRQUliU04wblo0S3NFNHNhdVJ5UkxDbjk4RjFMWEZ6N0Rsb3Y1L2czVXQyT2Y4SGI4emJOcDE2Y2RWM1lLCjR3N0NNYjBzR2FBUW5vSEdwVkU4bGRIVm9aTlM3N1lLVTJmZDZ4K2wzT2xsekNuK1Rvc0pBTkJ2b2psR0NwMWkKU1o4alZyWnY2eERzNkNzT2pkOWpzTHo5YzI3UnBHVmJHVjdCVlBkL0JyRVJ0N1dyTTl2WTZiQ1pxeGhCMUthcwp3TVh6MkNFUUJrOTNtMXNDbzcxYmo0dzhVNE42RkNOb2JGNzhKZlgyN1dicWFNTm1EUDgyOGtLYUovM2dHNmNICmRKczFvT0dpdUljN0Eva1lnNzVlR3haa3FkbmhncU40TXh2bXpYdzVFMjhldVpINnFTNUNDMXgrRU9ZMDdLaVQKNFlmaENURi9WSnlNTlFkN09pc2xYMzRGazg1Z2hudGxjenU5UU9WSUVSb0ZSSkMrdGxqYmhoSHFXU2w4Z1dYRwpadTA0TG5UbjlML0JBNm5IVHkvRUR2NXRiY2JVNDdnUXNOSy8rd1RJZ1hFNWhBY2Ezb0pSSmZoSEo1dUp1M0cyClpDYStKeFRtejgvMnBRaGhJbFV6Zm8rZml6QW1UVlFMSkxlMnAyQUNlZ25TdkZOMitpcUZqRGtRWEl6YWMvRnoKS2FEZEppbStFY2VvQzd4R0NHT1NUTm9PendFQWJkRnNSMnZGRjZwUHdVYkI1NU5FcE5YNjJremdUQi9ObndtUQp6MEFGcnhaZ2QwR0NHaU5RZ3RGNlhUZXh0SGgwMFFpQlFLT2gzTVgxb0tYUnBFK3JacVpBSlhQekQ0aXpFM3JlCkZ3Si9wSmw0NjY3dFlLYjNPVWlTSVlWNjIwWUZ1MXZlOFQvNU93eTByTFlhMzAwWG5RY1lCR1Jhb1c0QkVBQ3MKNmQwSEFpR0pCayswUUwvR2lMZnpnSTA2aERVSXFZYVhVaU9rUGFwUDhoaEF4UUUyUjJEN1IyTzB1M1JkS2lBcApmRUpXS0lVRi9OR0FFbTBRUkk0em1tQ2JrNHVRNHFQa1pRa29TY0ljUVBFQ0xGK1VMY3h3ZVBvZ1F6dFdNc0V1Cms1eHhRelU1SnZKbFNWaXMyR1QxZm5CcGJubHJodHFjUVg5c0ZxYU92bmxsVEE5d0Z3RWl2NWFyT2lTUzBaT0QKVkc1NzY4anMrRU9wM2RlS3kvVnQrWG84c09OMWtBQXRHMkN2dlNnVkNTZllSTG1UUmhNckxLOFlDL2Nmd3pvVgo3TnhMa1RETkZWaGdTRm1iaHdyVjBpejdCeVhnQWRDQUd1dzZLOGdDbSs5QXZraTd5cXZ4eS8vbmJnZzh3VURLClZnSkc1b2M0YzA5Q2p4NmR2WGVVRDVJRjZLMmxBV3I4VEp0bVdlME9lcFVMWmt5RDNHb0Q5RFdsT0VIaHk4YjkKVExBT00yOVJLUGxKWncyS1ZETTFXbTh4ak1Vak9HWDJnT1p2MEJJMVFiTlNWQXhYL3F6dVZ2SHdpR0pyU2RrZgpkaFJVMWFneXdTR2hLc2pSTkRJdFl2SGlVMDYzZ3cwRmFMZEV2NDU3L3BSRU5maHN4eWJpL1Y3eThvc0pCaDFGCkc1cHMxMThZN3g5UUpIUDJKNGl3RlJaRG4rVnpzL1dIYllHKzVZWlgzWUpoNnBKMVAyZTY3NXN3RWhsN0dHOHUKek10ZUtOaHhXR085Z3YwNjNodlh4MjhYaERBamdxZkN0ZWNYMWVJTmNXc25tVlBzMm9kZTVxeUVmcXRvNTFMSgpTZjFrUGRFeXQraWNiY24wT0xiVU1BYlI0L0NmWXNFRXpzZGdqdHIwOFFBUkFRQUJBQS82QThOV0tGSWpUVEphCk56UEdpS2xPaVluVmFQM2FFcDF2M0tpd3RtRVNMUW01ZmVWYnJLVDZoeFZyWmRKRGlzaUJLUzMzV3Awb29mUDUKMGpYMGNpdHZ4Yzg1QllHOVFwS3dHdWNZL3l1MXdmd20wcE9KSS9Zb01oVnI2aHBVZHdDRlJFQjVvZHhpMHVMVwpXUjV5dzlZMHdrUDFhZEg1NmYxbUVncjUzUzRVQTF6QlV4Tkg3YnBPYjhWb0g4TlU2dTROTGdrL0cwckxGVjhrCng5UllYY0NwRDNManRtRHFIbE9iTVdBY1owNndTZDdvWTFSQmpxTXloUmpFbWJzZTdtM0cvSldxU0ttNC9HbVgKd2dhcERwR3VpbTgzdytISXNQcVJJVXlVc2dKa2FLd2dsWkhlanRtdkNzVFVCYU1YSWsxWlhkM24wRWV4anlpeApRNk5PT1FRWHoxT3NEdXZFQWhXOFBFZEtGUGNZNDNMSkxHNGFzeVdrQWJiVDZ2cGZ0Z0REOVB6WmNDRkVuUjJ3CkkwQ0pkdDdOclZ0N0k3c3VFaEcwV2VVZTR5SEYzWmxxUFJkOWpraTBPb3dyZmduNWtFVUlGdDBnWTV1ZnJUUk8KYWxwT0RlMnJicmhzbU5PeG8rUmc3RVY3RTlyU1hISkRMMDkyOG41RDRDNkt5U0FwNk5LaXRpdTZSaXdMRmVrUwoxSTdaNUw2TGR2czU4L2k1Zjd6UjF3RW8rNEI3L0I3K0RLaWRQVGJzNUNMMW1pd2tkNHVtemE0VmZUQlpZdHhjCjRIVkU1dWN0R2Vqb2MzMW45T1hteXZhWDF6Vk40elVuYTAxVUNhWkZtQkxoZVhVTGhlM1ZsTGNjempWRC9Yc2kKOUVNTTc2V3VYWlBVVk1XQWxVQ1FzUHlqWWtSWHo5RUlBTkZ2aEMxZE5IaTdtdk9oMENWS2xMeUViRlhkZ0x1dApiQkRjMG9nenY2aWNYVXdZcHc4SVJ5S2pNRHBnRVhjbnRiZGYyVlZUNEQ3Vi83UTcvTFd2eUVOZnZWK000dHJLCmkyY3VXNXZER0R6Y3FPRS9LQ2MyVFMvbEhscXQ2WjhYeXBvaVdMZitpWnY0cTcwVXU3K1h0akdlK0dKeVJHQ3EKWWhCS3hRR0lCd3Zmc3o1ZHQydjhYY083QTkxeGUreHBRZjlXZ3JoaUhheWNyMzlkQ3RDcXg2RTk1Z1pXYzhScQp6TnZDZ0YrWlFUSDNYZE5CanB1QmJJd3ZVTXBCenVNUHozUEVTdXNTZ0p0cU8ySWl4c2EwZEpoc2JtTm50UEdGClVZWVBVTkZNcWVKc05nNVJKNEZwYS9VVU1LVlhDemI3WkR3ZnFxSHZtQzJGYmlJNU5xOEZ0Y2tJQU5OYm5RQkwKN3lxZWFuUEtCVWRmZU52TE5ZU2hsWEUyQzZVaElDeitDOHQ5OUJXRCtnVG5JSlluUXdKMVR0QjQwelR4UGQwYQpuTGRZSDlHQm5XTzFEMHNXbVMxSHo0NnQrWURnTjlHaXBXQWR1NW9na0ZlRkZwM1MvSGY5eVB2WGx2OVJ0ckpXCndwdXVhcjFNRExoTzJ0NWo1UlhZU0diSGMyOGdXdExPVkUrc0lHUTVpbXRMWjgvYVNrVTVOSTNycjlXWHNQekoKdjVvenc5OC9kcWdMRUo3MUU1OVQ5Q3NqM2xxYzc5SlY3QkhBck45TlhPTFBNaE1iTVlJT29WSU9DVS8zdXM4bgpBVXZtb2xENW5jK1RkTm9qa25EZW9EcWlEVXJNRkFuUDFLRHNDbXo4QWpWN1YzUVc1V05GRHplcXliVmQwdmkxCk1TNnhBdnVsQlZvWStla0gvMXNYNDErYUJQWnpZeWZNaW5jbWxMWUpacUVkWEdmaU0weXZNSU96VWRPN1dVTEkKY0xhWXVpNjE2TzcxZ2tOOXVGcllVeW1zY1BxVldCdEx2bUZnQWR5S0lucHhIRXU5RmFIM08rV0k0TFdEQ0V0dgovNnpCMlBEeWVaWjVOaE1QdGpweExOUzlvV1pVRG96MTEzVkYxeDdDbnJyTzZ2cDRCWkJ2WE5WYUVyb2cvMlNlCkpCZnNESG1kQWJpamtmZUYrL2NHcTNqQVRONHFGQStuR2pGdjd2cEpZelhhelJyMXI5cWxvTTlMVmttRXJCSzEKdEZyeFNKSjRsUXZqME1MSGw5TlVhTDJ1djY0a2lNZC9GYk5ma0p6V1JVTkhpcGJicFRZZ2pyRTVRUkx3UDVUYwpKajh6am53dkltK2RwL21zZTBuaW9EZnppRU9jWDhBMDBXdGJpYytHQW9rQ05nUVlBUWdBSUJZaEJDUVRGZDJyCmFHVVdMQU9KditVNG1oQjUxYVV2QlFKa1dxRnVBaHNNQUFvSkVPVTRtaEI1MWFVdlJMQVAvUnJJQ0dyNE40QWsKN0JmTVhqU1cva0lza3Ryd2R3VFE2aHUwckswMWFwNDE4SDFuNkRjUG55aEJSdXVxazZxM2Q4RzhtOFppT3JaNQpWa1p1OE5oeVh3Smcvc2xpaFZOYWVVN2M0OVlJait0Ni9vVDlPRW54bDRvcWpGZnJqaFVOOHhKbHdveHdWU0U5Cnh5RXhaVHpGTzZGcDJIQUVpQUFPMVBnRnVkbXJmRUpURXRxRkpPWFRvZm15V0xtd0hGNHhYUWpaZVNKYUY4a2QKNllBS1FJN082cEErS2hwOTdPRGl2bEV1Yk1BWi9zQVJ0NGNmQkFvdVNNSFpiVTdWZW9PV05IL1BNbDBwbEFaZwpiY0lTUlNIUXh0c3JPRVYrM0lScTN2cDZYczJ5OUZIeEdkbzBrTzNzQU5ZVXY4ZXpsYlNMQmhjTG1VT0U2S1RCClByUC9HdFNkdWJMVDdKTWFML3hVSm9LRzhIQnZ4RnhkbXpqNjRrNWx5WUgrWEVRMXNnT0xna1A0bkFZcTlmRzYKc1o0RHlNR1QrdDNGNFovQ3V3b0JYZzlrNVh0bVI0VHdENlRaODJiYmZaZzgrWjB4VTBZMWc3WkFoM1E2ZDBPKwptUXk1RXlrbGFFZHhrWlN5TVNVS1hDWFlDYU5tdk1OcXYwVVpMN3ZHcWFHNHBsRW9wVDlmTkptVk1mNDBQdHNSClpIUGtrQmU4WjVpaXdpQ2lXYlRPMjJRaFQrdFd0RHpHQ25LVWVjUlpYd3QzeGVkSVhKVXBCbW1YTkZicDU0MUkKdUl1WlJsYThKWW1WM1h0MWY5UDN0Q3UvQWlGQkpqaDlRUGVtd0o3NloydEtUOGFkaXNaVEE0V25PTGpHL3c4WgprdW9zY3JmazFtYzZ5WkNmeTJHTW1SNVc5eEJkQVg1ego9V29uagotLS0tLUVORCBQR1AgUFJJVkFURSBLRVkgQkxPQ0stLS0tLQo="

RUN <<EOF
set -eux
apk add --no-cache gnupg tini
EOF

COPY --from=builder --link /app/gpg-import /usr/local/bin/gpg-import
ENTRYPOINT ["tini", "--", "gpg-import"]
